<!DOCTYPE html>

<html>

<head>
   <title>Darlene Laguna Art</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link href="styles.css" rel="stylesheet" type="text/css">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
   <script language="JavaScript" src=scripts.js></script>
</head>

<body class="body" oncontextmenu="return false;">


<script>

var adjusted_image_height        = 0;
var adjusted_image_width         = 0;
var art_caption_style            = "";
var container_class              = "image_container_two_column";
var container_style              = 2;
var gallery_name                 = "";
var height_ratio                 = 1;
var image                        = "";
var image_file_name              = "";
var image_height                 = 0;
var image_width                  = 0;
var image_style                  = "";
var index                        = -1;
var max_number_of_images         = 40;
var minimum_caption_width        = 200;
var nav_button_vertical_position = 0;
var one_column_container         = 1;
var image_number                 = "";
var two_column_container         = 2;
var width_ratio                  = 1;
var URL_string                   = window.location.search;
var URL_parameters               = new URLSearchParams(URL_string);


image_file_name = URL_parameters.get("image_file_name");

if ( (image_file_name == null) || (image_file_name == "") )
{
   alert("Error:  Invalid image file name passed to display_image.html");

   history.back();
}

index = image_file_name.indexOf("/");

if (index != -1)
{
   gallery_name = image_file_name.slice(0, index);
}

if (gallery_name == "")
{
   alert("Error:  Invalid gallery name passed to display_image.html");

   history.back();
}

image_number = parseInt(image_file_name.replace(/\D/g, ''));

if (Number.isInteger(image_number) == false)
{
   alert("Error:  Invalid image number passed to display_image.html");

   history.back();
}

image     = new Image();
image.src = image_file_name;

image.onload = function()
{
   image_width  = this.width;
   image_height = this.height;

   width_ratio  = image_width/window.innerWidth;
   height_ratio = image_height/window.innerHeight;

   adjusted_image_width  = image_width/height_ratio;
   adjusted_image_height = image_height/width_ratio;

   if (window.innerWidth >= window.innerHeight)
   {
      if (image_height >= image_width)
      {
         container_style = two_column_container;
      }
      else
      {
         if (adjusted_image_height > window.innerHeight)
         {
            container_style = two_column_container;
         }
         else
         {
            container_style = one_column_container;
         }
      }
   }
   else
   {
      if (image_width >= image_height)
      {
         container_style = one_column_container;
      }
      else
      {
         if (adjusted_image_width > window.innerWidth)
         {
            container_style = one_column_container;
         }
         else
         {
            container_style = two_column_container;
         }
      }
   }

   if (container_style == two_column_container)
   {
      // Image height equals viewport height

      container_class = "image_container_two_column";

      nav_button_vertical_position = window.innerHeight / 2;

      art_caption_style = "style=\"max-width: 500px; padding-top: 5px\"";

      if (CSS.supports('height', '100dvh'))
      {
         image_style = "width: auto; height: 100dvh";
      }
      else
      {
         image_style = "width: auto; height: 100vh";
      }

      if ( (adjusted_image_width + minimum_caption_width) > (window.innerWidth) )
      {
         container_style = one_column_container;

         container_class = "image_container_one_column";

         nav_button_vertical_position = image_height * window.innerWidth/image_width / 2;

         art_caption_style = "style=\"height: auto; padding-left: 10px\"";

         image_style = "width: 100%; height: auto";
      }
   }
   else
   {
      // Image width equals viewport width

      container_class = "image_container_one_column";

      nav_button_vertical_position = image_height * window.innerWidth/image_width / 2;

      art_caption_style = "style=\"height: auto\"";

      image_style = "width: 100%; height: auto";
   }

   if (nav_button_vertical_position > window.innerHeight / 2)
   {
      nav_button_vertical_position = window.innerHeight / 2;
   }

   nav_button_vertical_position += "px";

   document.open();

   var d = document;

   d.writeln('<!DOCTYPE html>');
   d.writeln('');
   d.writeln('<html>');
   d.writeln('');
   d.writeln('<head>');
   d.writeln('   <title>Darlene Laguna Art</title>');
   d.writeln('   <meta name="viewport" content="width=device-width, initial-scale=1">');
   d.writeln('   <link href="styles.css" rel="stylesheet" type="text/css">');
   d.writeln('   <script language="JavaScript" src=scripts.js><\/script>');
   d.writeln('</head>');
   d.writeln('');
   d.writeln('<body class="body" onload="load_image_caption();" oncontextmenu="return false;">');
   d.writeln('');
   d.writeln('');
   d.writeln('<div class='+container_class+'>');
   d.writeln('');
   d.writeln('   <div style="display: inline-block; position: relative">');
   d.writeln('      <img src="'+image_file_name+'" style="'+image_style+'">');
   d.writeln('      <button class="nav_button nav_left" style="top: '+nav_button_vertical_position+'" onclick="update_image(\'left\');">&#9664;</button>');
   if (container_style == one_column_container)
   {
   d.writeln('      <button class="nav_button nav_right" style="top: '+nav_button_vertical_position+'" onclick="update_image(\'right\');">&#9654;</button>');
   d.writeln('      <button class="back_button" onclick="display_gallery_page();">&times;</button>');
   }
   d.writeln('   </div>');
   d.writeln('');
   d.writeln('   <div class="art_caption" '+art_caption_style+'>');
   if (container_style == two_column_container)
   {
   d.writeln('      <button class="nav_button nav_right" style="top: '+nav_button_vertical_position+'" onclick="update_image(\'right\');">&#9654;</button>');
   d.writeln('      <button class="back_button" onclick="display_gallery_page();">&times;</button>');
   }
   d.writeln('      <span id="image_title" class="art_title"></span><br>');
   d.writeln('      <span id="image_dimensions" class="art_dimensions"></span><br>');
   d.writeln('      <span id="image_paragraph" class="art_paragraph"></span>');
   d.writeln('   </div>');
   d.writeln('');
   d.writeln('</div>');
   d.writeln('');
   d.writeln('');
   d.writeln('</body>');
   d.writeln('');
   d.writeln('</html>');

   d.close();
}

function check_if_file_exists(gallery_name,image_number,direction)
{
   $.ajax
   (
   {
      url: gallery_name+"/"+gallery_name+"_"+image_number+".jpg",

      type: "HEAD",

      success: function()
      {
         window.location.href="display_image.html?image_file_name="+gallery_name+"/"+gallery_name+"_"+image_number+".jpg";

         return true;
      },

      error: function()
      {
         if (direction == "left")
         {
            if (image_number-1 >= 1)
            {
               check_if_file_exists(gallery_name,image_number-1,"left");
            }
            else
            {
               check_if_file_exists(gallery_name,max_number_of_images,"left");
            }

            return false;
         }
         else
         {
            if (image_number+1 <= max_number_of_images)
            {
               check_if_file_exists(gallery_name,image_number+1,"right");
            }
            else
            {
               check_if_file_exists(gallery_name,1,"right");
            }

            return false;
         }
      },
   }
   );

   return false;
}

function display_gallery_page()
{
   window.location.href = gallery_name+".html";
}

function load_image_caption()
{
   var file_path_prefix = image_file_name.split('.')[0];


   load_data_from_file(file_path_prefix+"_title.txt","image_title",false);
   load_data_from_file(file_path_prefix+"_dimensions.txt","image_dimensions",false);
   load_data_from_file(file_path_prefix+"_paragraph.txt","image_paragraph",false);
}

function update_image(direction)
{
   if (direction == "left")
   {
      check_if_file_exists(gallery_name,image_number-1,"left");
   }
   else
   {
      check_if_file_exists(gallery_name,image_number+1,"right");
   }
}

</script>


</body>

</html>